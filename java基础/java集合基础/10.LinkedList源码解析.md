# 1.LinkedListä»‹ç»
æˆ‘ä»¬é™¤äº†æœ€æœ€å¸¸ç”¨çš„`ArrayList`ä¹‹å¤–ï¼Œè¿˜æœ‰`LinkedList`ï¼Œè¿™åˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿä»[LinkedListå®˜æ–¹æ–‡æ¡£](https://docs.oracle.com/javase/8/docs/api/java/util/LinkedList.html)ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œå®ƒå…¶å®æ˜¯å®ç°äº†`List`å’Œ`Queue`çš„åŒå‘é“¾è¡¨ç»“æ„ï¼Œè€Œ`ArrayList`åº•å±‚åˆ™æ˜¯æ•°ç»„ç»“æ„ã€‚

ä¸‹é¢çš„è®²è§£åŸºäº`jdk 1.8`:

![](https://markdownpicture.oss-cn-qingdao.aliyuncs.com/blog/20201122144734.png)

ç»§æ‰¿äº†`AbstractSequentialList`ï¼Œå®ç°äº†`List`,`Queue`,`Cloneable`,`Serializable`ï¼Œæ—¢å¯ä»¥å½“æˆåˆ—è¡¨ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å½“æˆé˜Ÿåˆ—ï¼Œå †æ ˆä½¿ç”¨ã€‚ä¸»è¦ç‰¹ç‚¹æœ‰ï¼š
- çº¿ç¨‹ä¸å®‰å…¨ï¼Œä¸åŒæ­¥ï¼Œå¦‚æœéœ€è¦åŒæ­¥éœ€è¦ä½¿ç”¨`List list = Collections.synchronizedList(new LinkedList());`
- å®ç°`List`æ¥å£ï¼Œå¯ä»¥å¯¹å®ƒè¿›è¡Œé˜Ÿåˆ—æ“ä½œ
- å®ç°`Queue`æ¥å£ï¼Œå¯ä»¥å½“æˆå †æ ˆæˆ–è€…åŒå‘é˜Ÿåˆ—ä½¿ç”¨
- å®ç°Cloneableæ¥å£ï¼Œå¯ä»¥è¢«å…‹éš†ï¼Œæµ…æ‹·è´
- å®ç°`Serializable`ï¼Œå¯ä»¥è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–

ä¸‹é¢æ˜¯`LinkedList`çš„ç»“æ„ï¼Œ**æ³¨æ„ï¼šæŒ‡é’ˆç»“æŸæŒ‡å‘çš„æ˜¯nodeï¼Œå¼€å§‹çš„æ˜¯`prev`æˆ–è€…`next`**

![](https://markdownpicture.oss-cn-qingdao.aliyuncs.com/blog/20201129152058.png)



æºç å®šä¹‰å¦‚ä¸‹ï¼š
```java
public class LinkedList<E>
    extends AbstractSequentialList<E>
    implements List<E>, Deque<E>, Cloneable, java.io.Serializable{
    }
```

# 2.æˆå‘˜å˜é‡
æˆå‘˜å˜é‡ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºä¸åƒ`ArrayList`ä¸€æ ·ï¼Œéœ€è¦ä½¿ç”¨æ•°ç»„ä¿å­˜å…ƒç´ ï¼Œ`LinkedList`æ˜¯é å¼•ç”¨æ¥å…³è”å‰åèŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œåªæœ‰å¤§å°ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹,ä»¥åŠåºåˆ—åŒ–çš„uidã€‚
```java
    // å¤§å°
    transient int size = 0;
    // ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
    transient Node<E> first;
    // æœ€åä¸€ä¸ªèŠ‚ç‚¹
    transient Node<E> last;
		// åºåˆ—åŒ–uid
    private static final long serialVersionUID = 876323262645176354L;
```

æˆ‘ä»¬æ¥çœ‹çœ‹`Node`åˆ°åº•æ˜¯ä½•æ–¹ç¥åœ£ï¼Ÿ
å…¶å®å°±æ˜¯å†…éƒ¨ç±»ï¼Œé‡Œé¢çš„`item`æ˜¯çœŸæ­£ä¿å­˜èŠ‚ç‚¹çš„åœ°æ–¹ï¼Œnextæ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œ`prev`æ˜¯ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ã€‚è¿™é‡Œä¹Ÿä½“ç°äº†`LinkedList`å…¶å®å°±æ˜¯åŒçº¿é“¾è¡¨ã€‚

åªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä¸‰ä¸ªå‚æ•°åˆ†åˆ«å¯¹åº”ä¸‰ä¸ªå±æ€§ã€‚
```java
    private static class Node<E> {
        // èŠ‚ç‚¹é‡Œé¢çš„æ•°æ®
        E item;
        // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨
        Node<E> next;
        // ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨
        Node<E> prev;

        // èŠ‚ç‚¹çš„æ„é€ å‡½æ•°ï¼Œé‡å†™ä¹‹åï¼Œæ— å‚æ•°æ„é€ å™¨å·²ç»è¢«è¦†ç›–ï¼Œä¸‰ä¸ªå‚æ•°åˆ†åˆ«å¯¹åº”ä¸‰ä¸ªå±æ€§
        Node(Node<E> prev, E element, Node<E> next) {
            this.item = element;
            this.next = next;
            this.prev = prev;
        }
    }
```

# 3. æ„é€ å‡½æ•°
æ„é€ å‡½æ•°æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ— å‚æ•°æ„é€ å‡½æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯åˆå§‹åŒ–é›†åˆå…ƒç´ ï¼Œé‡Œé¢è°ƒç”¨çš„å…¶å®æ˜¯`addAll`ï¼Œä¸€çœ‹å°±æ˜¯å°†é‡Œé¢æ‰€æœ‰çš„å…ƒç´ åŠ å…¥åˆ°é›†åˆä¸­ã€‚
```java
    public LinkedList() {
    }
    public LinkedList(Collection<? extends E> c) {
        this();
        addAll(c);
    }
```

# 4. å¸¸ç”¨Listæ–¹æ³•è§£æ
## 4.1 æŸ¥æ‰¾ç›¸å…³
### 4.1.1 getFirst()

è·å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š

```java
    public E getFirst() {
        // ä¿å­˜ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºfï¼Œæ³¨æ„æ˜¯finalçš„ï¼Œ
        final Node<E> f = first;
        if (f == null)
            // å¦‚æœæ²¡æœ‰ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºå¼‚å¸¸
            throw new NoSuchElementException();
        // è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ çš„item
        return f.item;
    }
```

### 4.1.2 getLast()

è·å–æœ€åä¸€ä¸ªå…ƒç´ ,å’Œè·å–ç¬¬ä¸€ä¸ªçš„åŸç†å·®ä¸å¤š

```java
    public E getLast() {
        // ä¿å­˜æœ€åä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨ä¸ºl
        final Node<E> l = last;
        // å¦‚æœä¸ºç©ºï¼ŒæŠ›å‡ºé”™è¯¯
        if (l == null)
            throw new NoSuchElementException();
        // è¿”å›item
        return l.item;
    }
```

### 4.1.3 get(int index)

é€šè¿‡ç´¢å¼•æ¥è·å–å…ƒç´ ,é‡Œé¢æ˜¯è°ƒç”¨äº†å¦å¤–ä¸€ä¸ªæ–¹æ³•å…ˆè·å–èŠ‚ç‚¹ï¼Œå†è·å–è¯¥èŠ‚ç‚¹çš„`item`,åœ¨æ­¤ä¹‹å‰ï¼Œåšäº†`index`å®‰å…¨æ€§æ ¡éªŒã€‚

```java
    public E get(int index) {
        checkElementIndex(index);
        return node(index).item;
    }
```



åœ¨ğŸ‘†ä¸Šé¢çš„ä»£ç ä¸­è°ƒç”¨äº†é€šè¿‡ç´¢å¼•ä½ç½®æŸ¥æ‰¾èŠ‚ç‚¹ä½ç½®çš„å‡½æ•°ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªå‡½æ•°,ç”±äºåº•å±‚æ˜¯é“¾è¡¨å®ç°çš„ï¼Œæ‰€ä»¥å‘¢ï¼Ÿéå†èµ·æ¥ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå°±è€ƒè™‘åˆ°ä½è¿ç®—ï¼Œå¦‚æœç´¢å¼•ä½ç½®åœ¨åé¢ä¸€åŠï¼Œå°±ä»åå¾€å‰éå†æŸ¥æ‰¾ï¼Œå¦åˆ™ä»å‰å¾€åéå†ã€‚

```java
    Node<E> node(int index) {
        // assert isElementIndex(index);
				// size>>1 è¡¨ç¤ºé™¤ä»¥2ï¼Œç›¸å½“äºindexå°äºsizeçš„ä¸€åŠ
        if (index < (size >> 1)) {
          	// ä»å‰é¢å¼€å§‹éå†ï¼Œå–å‡ºfirstèŠ‚ç‚¹ï¼Œå› ä¸ºä¸­é—´è¿‡ç¨‹å¼•ç”¨ä¼šå˜åŒ–ï¼Œæ‰€ä»¥ä¸å¯ç›´æ¥æ“ä½œfirst
            Node<E> x = first;
          	// é€šè¿‡å¾ªç¯è®¡æ•°æ¥æŸ¥æ‰¾
            for (int i = 0; i < index; i++)
                x = x.next;
            return x;
        } else {
          	// å–å‡ºæœ€åä¸€ä¸ªå…ƒç´ 
            Node<E> x = last;
          	// ä»åå¾€å‰éå†
            for (int i = size - 1; i > index; i--)
                x = x.prev;
            return x;
        }
    }
```

### 4.1.4 indexOf(Object o)

æŸ¥æ‰¾æŸä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ä½ç½®,åˆ†ä¸ºä¸¤ç§æƒ…å†µè®¨è®ºï¼Œå¦‚æœè¦æŸ¥æ‰¾çš„å…ƒç´ ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ä½¿ç”¨`==`ï¼Œå¦åˆ™ä½¿ç”¨`equals()`ï¼Œè¿™ä¹Ÿä»ä¾§é¢å°è¯äº†`LinedList`å®é™…ä¸Šæ˜¯å¯ä»¥å­˜å‚¨`null`å…ƒç´ çš„ã€‚ä½¿ç”¨è®¡æ•°æŸ¥æ‰¾ï¼š

```java
    public int indexOf(Object o) {
        int index = 0;
      	// å¦‚æœéœ€è¦æŸ¥æ‰¾nullå…ƒç´ 
        if (o == null) {
            for (Node<E> x = first; x != null; x = x.next) {
                if (x.item == null)
                    return index;
                index++;
            }
        } else {
          	// æŸ¥æ‰¾å…ƒç´ ä¸ä¸ºç©º
            for (Node<E> x = first; x != null; x = x.next) {
                if (o.equals(x.item))
                    return index;
                index++;
            }
        }
        return -1;
    }
```

### 4.1.5 lastIndexOf(Object o)

å’Œå‰é¢çš„`indexOf`å·®ä¸å¤šï¼ŒåŒºåˆ«å°±æ˜¯è¿™ä¸ªæ˜¯åé¢å¼€å§‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆçš„å…ƒç´ ã€‚

```java
    public int indexOf(Object o) {
        int index = 0;
      	// æŸ¥æ‰¾å…ƒç´ 
        if (o == null) {
            for (Node<E> x = first; x != null; x = x.next) {
                if (x.item == null)
                    return index;
                index++;
            }
        } else {
            for (Node<E> x = first; x != null; x = x.next) {
                if (o.equals(x.item))
                    return index;
                index++;
            }
        }
        return -1;
    }
```



## 4.2 æ·»åŠ å…ƒç´ 

### 4.2.1 addFirst(E e)

å°†å…ƒç´ eï¼Œæ·»åŠ åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¬æœ‰æ–¹æ³•æ˜¯`addFirst()`ï¼Œä½†æ˜¯å…¶å®å†…éƒ¨è°ƒç”¨æ˜¯`linkFirst()`ï¼Œè¿™æ˜¯`private`æ–¹æ³•ã€‚
``` java
    public void addFirst(E e) {
        linkFirst(e);
    }
    private void linkFirst(E e) {
        // å…ˆä¿å­˜ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
        final Node<E> f = first;
        // åˆå§‹åŒ–ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œprevæ˜¯nullï¼Œnextæ˜¯fï¼ˆä¹‹å‰çš„é¦–èŠ‚ç‚¹ï¼‰
        final Node<E> newNode = new Node<>(null, e, f);
        // æ›´æ–°firstä¸ºæ–°èŠ‚ç‚¹
        first = newNode;
        // å¦‚æœä¹‹å‰çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå°±è¯´æ˜é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ²¡æœ‰å…ƒç´ 
        if (f == null)
            // æœ€åä¸€ä¸ªå…ƒç´ ä¹Ÿæ˜¯æ–°åŠ å…¥çš„å…ƒç´ 
            last = newNode;
        else
            // fçš„prevå‰ç½®èŠ‚ç‚¹çš„å¼•ç”¨æ›´æ–°ä¸ºæ–°çš„èŠ‚ç‚¹
            f.prev = newNode;
        // ä¸ªæ•°å¢åŠ 
        size++;
        // ä¿®æ”¹æ¬¡æ•°å¢åŠ 
        modCount++;
    }
```
### 4.2.2 addLast(E e)

å°†å…ƒç´ æ·»åŠ åœ¨é“¾è¡¨æœ€åï¼Œå…¶å®å†…éƒ¨ä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨çš„`private`æ–¹æ³•`linkLast()`:

```java
    public void addLast(E e) {
        linkLast(e);
    }
    void linkLast(E e) {
        // ä¿å­˜æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨
        final Node<E> l = last;
        // åˆå§‹åŒ–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå‰ç½®èŠ‚ç‚¹æŒ‡é’ˆå¼•ç”¨æŒ‡å‘ä¹‹å‰çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œåç»­èŠ‚ç‚¹çš„å¼•ç”¨æ˜¯null
        final Node<E> newNode = new Node<>(l, e, null);
        // å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹æ›´æ–°
        last = newNode;
        // å¦‚æœä¹‹å‰çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯nullï¼Œè¯´æ˜é“¾è¡¨æ˜¯ç©ºçš„
        if (l == null)
            // æ–°èŠ‚ç‚¹åŒæ—¶æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
            first = newNode;
        else
            // å¦åˆ™ä¹‹å‰çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„åç»­èŠ‚ç‚¹å¼•ç”¨æ›´æ–°ä¸ºæ–°çš„èŠ‚ç‚¹
            l.next = newNode;
        // å¤§å°+1
        size++;
        // ä¿®æ”¹æ¬¡æ•°+1
        modCount++;
    }
```

### 4.2.3 add(E e)

å¢åŠ å…ƒç´ ï¼Œé»˜è®¤ä¹Ÿæ˜¯åœ¨é“¾è¡¨çš„æœ€åæ·»åŠ ï¼Œå®Œæˆè¿”å›trueï¼š

```java
    public boolean add(E e) {
        linkLast(e);
        return true;
    }
```

### 4.2.4 addAll(Collection<? extends E> c)

å¾€é“¾è¡¨é‡Œé¢æ‰¹é‡æ·»åŠ å…ƒç´ ,é‡Œé¢é»˜è®¤æ˜¯åœ¨æœ€åé¢æ‰¹é‡æ·»åŠ ï¼Œå†…éƒ¨è°ƒç”¨çš„æ˜¯`addAll(int index, Collection<? extends E> c)`,æ·»åŠ ä¹‹å‰ä¼šåˆ¤æ–­ç´¢å¼•ä½ç½®æ˜¯ä¸æ˜¯åˆæ³•çš„ã€‚
ç„¶åæŸ¥æ‰¾éœ€è¦æ’å…¥çš„ä½ç½®çš„å‰åèŠ‚ç‚¹ï¼Œå¾ªç¯æ’å…¥ã€‚

```java
    public boolean addAll(Collection<? extends E> c) {
        return addAll(size, c);
    }

    public boolean addAll(int index, Collection<? extends E> c) {
        // æ£€æŸ¥æ·»åŠ ä½ç½®
        checkPositionIndex(index);

        // å°†éœ€è¦æ·»åŠ çš„é›†åˆè½¬æ¢æˆä¸ºæ•°ç»„
        Object[] a = c.toArray();
        // è·å–æ•°ç»„çš„å¤§å°
        int numNew = a.length;
        // å¦‚æœæ•°ç»„é•¿åº¦ä¸º0ï¼Œè¯´æ˜æ²¡æœ‰éœ€è¦æ·»åŠ çš„å…ƒç´ ï¼Œè¿”å›false
        if (numNew == 0)
            return false;

        // æ’å…¥ä½ç½®çš„å‰èŠ‚ç‚¹å’Œåç»­èŠ‚ç‚¹
        Node<E> pred, succ;
        // å¦‚æœæ’å…¥ä½ç½®ç´¢å¼•å¤§å°ç­‰äºé“¾è¡¨å¤§å°ï¼Œé‚£ä¹ˆå°±æ˜¯åœ¨æœ€åæ’å…¥å…ƒç´ 
        if (index == size) {
            // æœ€åæ’å…¥å…ƒç´ æ²¡æœ‰åç»­èŠ‚ç‚¹
            succ = null;
            // å‰ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¹‹å‰çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹
            pred = last;
        } else {
            // æŸ¥æ‰¾åˆ°ç´¢å¼•ä¸ºindex çš„èŠ‚ç‚¹
            succ = node(index);
            // è·å–å‰ä¸€ä¸ªèŠ‚ç‚¹
            pred = succ.prev;
        }
        
        // å¾ªç¯æ’å…¥èŠ‚ç‚¹
        for (Object o : a) {
            @SuppressWarnings("unchecked") E e = (E) o;
            // åˆå§‹åŒ–æ–°èŠ‚ç‚¹ï¼Œä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯pred
            Node<E> newNode = new Node<>(pred, e, null);
            // å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯nullï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯æ–°çš„èŠ‚ç‚¹
            if (pred == null)
                first = newNode;
            else
                // å¦åˆ™predçš„nextç½®ä¸ºæ–°èŠ‚ç‚¹
                pred.next = newNode;
            pred = newNode;
        }

        // å¦‚æœæ’å…¥ä½ç½®æ²¡æœ‰åç»­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯succä¸ºnull
        if (succ == null) {
            // æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå°±æ˜¯predï¼Œåˆšåˆšæ’å…¥çš„æ–°èŠ‚ç‚¹
            last = pred;
        } else {
            // åŠ å…¥æ‰€æœ‰å…ƒç´ ä¹‹åçš„æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘succï¼ˆåç»­å…ƒç´ ï¼‰
            pred.next = succ;
            // æ’å…¥ä½ç½®çš„åç»­å…ƒç´ çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹å¼•ç”¨æŒ‡å‘pred
            succ.prev = pred;
        }
      	// å¤§å°æ”¹å˜
        size += numNew;
      	// ä¿®æ”¹æ¬¡æ•°å¢åŠ 
        modCount++;
        return true;
    }
```

ä¸Šé¢çš„ä»£ç è°ƒç”¨äº†`node(index)`ï¼Œè¿™ä¸ªåœ¨å‰é¢æŸ¥æ‰¾çš„æ—¶å€™å·²ç»è¯´è¿‡äº†ï¼Œä¸å†è§£é‡Šã€‚

### 4.2.5 addAll(int index, Collection<? extends E> c)

åœ¨æŒ‡å®šä½ç½®æ‰¹é‡æ’å…¥èŠ‚ç‚¹ï¼š

```java
    public boolean addAll(int index, Collection<? extends E> c) {
      	// æ£€æŸ¥ç´¢å¼•åˆæ³•æ€§
        checkPositionIndex(index);
      	// å°†éœ€è¦æ’å…¥çš„é›†åˆè½¬æ¢æˆä¸ºæ•°ç»„
        Object[] a = c.toArray();
      	// æ•°ç»„çš„é•¿åº¦
        int numNew = a.length;
      	// ä¸º0åˆ™ä¸éœ€è¦æ’å…¥
        if (numNew == 0)
            return false;
      	// æ’å…¥ä½ç½®çš„å‰èŠ‚ç‚¹å’ŒåèŠ‚ç‚¹
        Node<E> pred, succ;
      	// å¦‚æœåœ¨æœ€åæ’å…¥
        if (index == size) {
          	// åèŠ‚ç‚¹ä¸ºç©º
            succ = null;
          	// å‰èŠ‚ç‚¹æ˜¯æœ€åä¸€ä¸ª
            pred = last;
        } else {
          	// è·å–æ’å…¥ä½ç½®çš„åèŠ‚ç‚¹
            succ = node(index);
          	// è·å–å‰èŠ‚ç‚¹
            pred = succ.prev;
        }
				
      	// éå†
        for (Object o : a) {
            @SuppressWarnings("unchecked") E e = (E) o;
          	// åˆå§‹åŒ–èŠ‚ç‚¹ï¼Œå‰ç½®èŠ‚ç‚¹æ˜¯æ’å…¥ä½ç½®çš„å‰èŠ‚ç‚¹ï¼Œåç»­èŠ‚ç‚¹ä¸ºnull
            Node<E> newNode = new Node<>(pred, e, null);
          	// å¦‚æœæ’å…¥ä½ç½®å‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯nullï¼Œè¯´æ˜æ’å…¥ä½ç½®æ˜¯é“¾è¡¨é¦–
            if (pred == null)
              	// é¦–èŠ‚ç‚¹å°±æ˜¯æ–°æ’å…¥çš„èŠ‚ç‚¹
                first = newNode;
            else
              	// å‰èŠ‚ç‚¹çš„nextæŒ‡å‘æ–°èŠ‚ç‚¹
                pred.next = newNode;
          	// æ›´æ–°æ’å…¥ä½ç½®çš„å‰ä¸€ä¸ªèŠ‚ç‚¹
            pred = newNode;
        }
      	// å¦‚æœæ’å…¥ä½ç½®çš„åä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºï¼Œè¯´æ˜æ’å…¥ä½ç½®æ˜¯é“¾è¡¨å°¾éƒ¨
        if (succ == null) {
          	// æœ€åä¸€ä¸ªå…ƒç´ å°±æ˜¯æ’å…¥çš„å…ƒç´ 
            last = pred;
        } else {
          	// å°†æ’å…¥çš„æœ€åä¸€ä¸ªå…ƒç´ nextæŒ‡å‘succ
            pred.next = succ;
          	// succçš„ä¸Šä¸€ä¸ªå…ƒç´ æŒ‡å‘prev
            succ.prev = pred;
        }
      	// å¤§å°æ›´æ–°
        size += numNew;
      	// ä¿®æ”¹æ¬¡æ•°æ”¹å˜
        modCount++;
      	// è¿”å›æˆåŠŸ
        return true;
    }
```



### 4.2.6 add(int index,E element)

å°†å…ƒç´ æ’å…¥åœ¨æŒ‡å®šä½ç½®,å…ˆåˆ¤æ–­ç´¢å¼•ä½ç½®ï¼Œå¦‚æœç´¢å¼•ä½ç½®æ˜¯æœ€åä¸€ä¸ªï¼Œé‚£ä¹ˆç›´æ¥è°ƒç”¨åœ¨æœ€åæ·»åŠ å…ƒç´ å‡½æ•°å³å¯ï¼Œå¦åˆ™éœ€è¦è°ƒç”¨å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨æŸä¸ªå…ƒç´ å‰é¢æ’å…¥ï¼š

```java
    public void add(int index, E element) {
      	// indexæ ¡éªŒ
        checkPositionIndex(index);
      	
      	// ç´¢å¼•ç­‰äºé“¾è¡¨å¤§å°
        if (index == size)
          	// ç›´æ¥åœ¨æœ€åæ’å…¥å…ƒç´ 
            linkLast(element);
        else
          	// åœ¨æŸä¸ªèŠ‚ç‚¹å‰æ’å…¥å…ƒç´ 
            linkBefore(element, node(index));
    }
```

### 

## 4.3 åˆ é™¤å…ƒç´ 

### 4.3.1 removeFirst()

åˆ é™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…ˆè·å–é¦–èŠ‚ç‚¹ï¼Œåˆ¤æ–­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™è¯æ˜æ²¡æœ‰è¯¥èŠ‚ç‚¹ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œå†…éƒ¨è°ƒç”¨çš„å…¶å®æ˜¯`unlinkFirst()`ã€‚è¿”å›å€¼æ˜¯è¢«ç§»é™¤çš„èŠ‚ç‚¹é‡Œé¢çš„æ•°å€¼ã€‚

```java
    public E removeFirst() {
        final Node<E> f = first;
        if (f == null)
            throw new NoSuchElementException();
        return unlinkFirst(f);
    }
		// ç§»é™¤é¦–èŠ‚ç‚¹
    private E unlinkFirst(Node<E> f) {
        // assert f == first && f != null;
      	// è·å–é‡Œé¢çš„å…ƒç´ 
        final E element = f.item;
      	// ä¿å­˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        final Node<E> next = f.next;
      	// å°†ä¹‹å‰çš„é¦–èŠ‚ç‚¹å‰åèŠ‚ç‚¹å¼•ç”¨ç½®ç©ºï¼Œæœ‰åˆ©äºGC
        f.item = null;
        f.next = null; // help GC
      	// é¦–èŠ‚ç‚¹æ›´æ–°
        first = next;
      	// å¦‚æœé¦–èŠ‚ç‚¹æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆé“¾è¡¨æ²¡æœ‰å…ƒç´ äº†ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹è‡ªç„¶ä¹Ÿæ˜¯null
        if (next == null)
            last = null;
        else
          	// å¦åˆ™å½“å‰çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹ç½®null
            next.prev = null;
      	// é“¾è¡¨å¤§å°-1
        size--;
      	// ä¿®æ”¹æ¬¡æ•°å¢åŠ 
        modCount++;
        return element;
    }
```



### 4.3.2 removeLast()

åˆ é™¤æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå’Œä¸Šé¢çš„åˆ é™¤é¦–èŠ‚ç‚¹å·®ä¸å¤šï¼Œå…ˆå–å‡ºæœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™ä¼šè°ƒç”¨å¦ä¸€ä¸ªè§£é™¤è¿æ¥çš„å‡½æ•°`unLinkLast()`ã€‚

```java
    public E removeLast() {
        final Node<E> l = last;
        if (l == null)
            throw new NoSuchElementException();
        return unlinkLast(l);
    }
    private E unlinkLast(Node<E> l) {
        // assert l == last && l != null;
      	// ä¿å­˜è¢«ç§»é™¤çš„èŠ‚ç‚¹çš„item
        final E element = l.item;
      	// è·å–ä¸Šä¸€ä¸ªèŠ‚ç‚¹
        final Node<E> prev = l.prev;
      	// å‰åå¼•ç”¨ç½®ç©ºï¼Œæœ‰åˆ©äºåƒåœ¾å›æ”¶
        l.item = null;
        l.prev = null; // help GC
      	// æ›´æ–°æœ€åä¸€ä¸ªèŠ‚ç‚¹
        last = prev;
      	// å¦‚æœå‰ç½®èŠ‚ç‚¹ä¸ºç©ºï¼Œé‚£ä¹ˆé“¾è¡¨å·²ç»æ²¡æœ‰å…ƒç´ äº†
        if (prev == null)
            first = null;
        else
          	// å¦åˆ™å°†ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„nextç½®null
            prev.next = null;
      	// å¤§å°è¯¥è¡¨
        size--;
      	// ä¿®æ”¹æ¬¡æ•°å¢åŠ 
        modCount++;
      	// è¿”å›è¢«ç§»é™¤çš„èŠ‚ç‚¹çš„itemå€¼
        return element;
    }

```



### 4.3.3 remove(Object o)

åˆ é™¤æŸä¸ªå…ƒç´ åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œå…ƒç´ ä¸ºnullå’Œénull,ç›´æ¥éå†åˆ¤æ–­ï¼Œé‡Œé¢çœŸæ­£åˆ é™¤çš„æ–¹æ³•å…¶å®æ˜¯`unlink(E e)`ï¼ŒæˆåŠŸç§»é™¤åˆ™è¿”å›trueï¼Œæ³¨æ„è¿™é‡Œåªä¼šç§»é™¤æ‰ç¬¬ä¸€ä¸ªï¼Œåç»­è¦æ˜¯è¿˜æœ‰è¯¥èŠ‚ç‚¹ï¼Œä¸ä¼šç§»é™¤ã€‚

```java
    public boolean remove(Object o) {
      	// å…ƒç´ ä¸ºnull
        if (o == null) {
            for (Node<E> x = first; x != null; x = x.next) {
                if (x.item == null) {
                    unlink(x);
                    return true;
                }
            }
        } else {
          	// å…ƒç´ ä¸ä¸ºnull
            for (Node<E> x = first; x != null; x = x.next) {
                if (o.equals(x.item)) {
                  	// ç§»é™¤èŠ‚ç‚¹
                    unlink(x);
                    return true;
                }
            }
        }
        return false;
    }
```

`unLink(E e)`æ–¹æ³•å¦‚ä¸‹ï¼š

```java
    E unlink(Node<E> x) {
        // assert x != null;
      	// ä¿å­˜è¢«ç§»é™¤èŠ‚ç‚¹çš„item
        final E element = x.item;
      	// ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        final Node<E> next = x.next;
      	// ä¸Šä¸€ä¸ªèŠ‚ç‚¹
        final Node<E> prev = x.prev;
      	// å¦‚æœå‰ç½®èŠ‚ç‚¹ä¸ºç©ºï¼Œé‚£ä¹ˆé¦–èŠ‚ç‚¹å°±æ˜¯å½“å‰èŠ‚ç‚¹äº†
        if (prev == null) {
            first = next;
        } else {
          	// å‰ä¸€ä¸ªèŠ‚ç‚¹çš„nextç½®ä¸ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹
            prev.next = next;
          	// ä¹‹å‰çš„èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ç½®null
            x.prev = null;
        }
      	// å¦‚æœnextæ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆä¸Šä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ç°åœ¨æœ€åä¸€ä¸ªèŠ‚ç‚¹
        if (next == null) {
            last = prev;
        } else {
          	// nextçš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹å¼•ç”¨æŒ‡å‘prev
            next.prev = prev;
          	// è¢«åˆ é™¤çš„å…ƒç´ çš„nextç½®ç©º
            x.next = null;
        }
      	// itemç½®ç©º
        x.item = null;
      	// å¤§å°æ”¹å˜
        size--;
      	// ä¿®æ”¹æ¬¡æ•°å¢åŠ 
        modCount++;
      	// è¿”å›è¢«åˆ é™¤çš„èŠ‚ç‚¹é‡Œé¢çš„item
        return element;
    }
```

### 4.3.4 clear()

ç§»é™¤é‡Œé¢æ‰€æœ‰çš„å…ƒç´ ï¼š

```java
    public void clear() {
        // Clearing all of the links between nodes is "unnecessary", but:
        // - helps a generational GC if the discarded nodes inhabit
        //   more than one generation
        // - is sure to free memory even if there is a reachable Iterator
        for (Node<E> x = first; x != null; ) {
          	// ä¿å­˜ä¸‹ä¸€ä¸ª
            Node<E> next = x.next;
          	// å½“å‰å…ƒç´ ç½®ç©º
            x.item = null;
            x.next = null;
            x.prev = null;
            x = next;
        }
      	// é¦–èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹å…¨éƒ¨ç½®null
        first = last = null;
        size = 0;
        modCount++;
    }
```



### 4.3.5 removeï¼ˆint indexï¼‰

ç§»é™¤æŒ‡å®šç´¢å¼•çš„å…ƒç´ ã€‚å…ˆé€šè¿‡ç´¢å¼•æ‰¾åˆ°èŠ‚ç‚¹ï¼Œå†ç§»é™¤æŒ‡å®šçš„èŠ‚ç‚¹

```java
    public E remove(int index) {
      	// æ£€æŸ¥åˆæ³•æ€§
        checkElementIndex(index);
      	// å…ˆæ‰¾åˆ°èŠ‚ç‚¹ï¼Œå†ç§»é™¤æŒ‡å®šèŠ‚ç‚¹
        return unlink(node(index));
    }
```



## 4.4 æ›´æ–°å…ƒç´ 

### 4.4.1 set(int index,E element)

æ›´æ–°æŒ‡å®šç´¢å¼•çš„ä½ç½®çš„å…ƒç´ ,é¦–å…ˆé€šè¿‡ç´¢å¼•æŸ¥æ‰¾åˆ°è¯¥å…ƒç´ ï¼Œç„¶åä¿®æ”¹itemå€¼ï¼Œè¿”å›æ—§çš„itemå€¼ã€‚

```java
    public E set(int index, E element) {
      	// æ£€æŸ¥ç´¢å¼•æ˜¯å¦åˆæ³•
        checkElementIndex(index);
      	// é€šè¿‡ç´¢å¼•æŸ¥æ‰¾åˆ°èŠ‚ç‚¹
        Node<E> x = node(index);
      	// ä¿å­˜æ—§çš„å€¼
        E oldVal = x.item;
      	// ä¿®æ”¹
        x.item = element;
      	// è¿”å›æ—§çš„å…ƒç´ 
        return oldVal;
    }
```





# 5 queueç›¸å…³çš„æ–¹æ³•

å› ä¸º`LinkedList`ä¹Ÿå®ç°äº†`queue`æ¥å£ï¼Œæ‰€ä»¥å®ƒè‚¯å®šä¹Ÿå®ç°äº†ç›¸å…³çš„æ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ï¼š

## 5.1 peek()

è·å–é˜Ÿåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š

```java
    public E peek() {
      	// æ‹¿åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œfinalä¸å¯å˜
        final Node<E> f = first;
      	// è¿”å›itemå€¼
        return (f == null) ? null : f.item;
    }
```

## 5.2 element()

ä¹Ÿæ˜¯è·å–é˜Ÿåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œé‡Œé¢è°ƒç”¨çš„æ˜¯`getFirst()`ã€‚

```java
    public E element() {
        return getFirst();
    }
```

## 5.3 poll()

ç§»é™¤é˜Ÿåˆ—ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å…ƒç´ å¹¶è¿”å›ï¼Œé‡Œé¢è°ƒç”¨çš„å…¶å®æ˜¯`unlinkFirst()`

```java
    public E poll() {
      	// è·å–åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ 
        final Node<E> f = first;
      	// ç§»é™¤å¹¶è¿”å›
        return (f == null) ? null : unlinkFirst(f);
    }
```

## 5.4 remove()

ç§»é™¤é˜Ÿåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ ,é‡Œé¢è°ƒç”¨çš„æ˜¯`removeFirst()`:

```java
    public E remove() {
        return removeFirst();
    }
```

## 5.5 offfer(E e)

åœ¨é˜Ÿåˆ—åé¢å¢åŠ å…ƒç´ ï¼š

```java
    public boolean offer(E e) {
        return add(e);
    }
```

## 5.6 offerFirst(E e)

å¾€é˜Ÿåˆ—çš„å‰é¢æ’å…¥å…ƒç´ ï¼Œå…¶å®è°ƒç”¨çš„æ˜¯`addFirst()`

```java
    public boolean offerFirst(E e) {
        addFirst(e);
        return true;
    }
```

## 5.7 offerLast(E e)

å¾€é˜Ÿåˆ—çš„åé¢æ·»åŠ å…ƒç´ ,å…¶å®è°ƒç”¨çš„æ˜¯`addList()`

```java
    public boolean offerLast(E e) {
        addLast(e);
        return true;
    }
```



## 5.8 peekFirst()

è·å–ç¬¬ä¸€ä¸ªèŠ‚ç‚¹é‡Œé¢çš„å…ƒç´ :

```java
    public E peekFirst() {
        final Node<E> f = first;
        return (f == null) ? null : f.item;
     }
```



## 5.9 peekLast()

è·å–æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„å…ƒç´ ï¼š

```java
    public E peekLast() {
        final Node<E> l = last;
        return (l == null) ? null : l.item;
    }
```

## 5.10 pollFirst()

è·å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”ç§»é™¤å®ƒ,ä½¿ç”¨çš„æ˜¯`unlinkFirst(E e)`

```java
    public E pollFirst() {
        final Node<E> f = first;
        return (f == null) ? null : unlinkFirst(f);
    }
```

## 5.11 pollLastï¼ˆï¼‰

è·å–é˜Ÿåˆ—æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”ç§»é™¤å®ƒ,è°ƒç”¨çš„å…¶å®æ˜¯`unlinkLast(E e)`

```java
    public E pollLast() {
        final Node<E> l = last;
        return (l == null) ? null : unlinkLast(l);
    }
```

## 5.12 push(E e)

åƒæ˜¯å †æ ˆçš„ç‰¹ç‚¹ï¼Œåœ¨å‰é¢æ·»åŠ å…ƒç´ ï¼š

```java
    public void push(E e) {
        addFirst(e);
    }
```

## 5.13 pop()

å †æ ˆçš„ç‰¹ç‚¹ï¼Œå–å‡ºé˜Ÿåˆ—é¦–çš„ç¬¬ä¸€ä¸ªå…ƒç´ 

```java
    public E pop() {
        return removeFirst();
    }
```



## 5.14 removeFirstOccurrence(Object o)

ç§»é™¤å…ƒç´ ,ä»å‰å¾€åç¬¬ä¸€æ¬¡å‡ºç°çš„åœ°æ–¹ç§»é™¤æ‰ï¼š

```java
    public boolean removeFirstOccurrence(Object o) {
        return remove(o);
    }
```

## 5.15 removeLastOccurrenceï¼ˆObject oï¼‰

ç§»é™¤å…ƒç´ ï¼Œæœ€åä¸€æ¬¡å‡ºç°çš„åœ°æ–¹ç§»é™¤æ‰,å’Œå‰é¢åˆ†æçš„ä¸€æ ·ï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œnullå’Œénullã€‚

```java
    public boolean removeLastOccurrence(Object o) {
      	// å…ƒç´ ä¸ºnull
        if (o == null) {
            for (Node<E> x = last; x != null; x = x.prev) {
                if (x.item == null) {
                    unlink(x);
                    return true;
                }
            }
        } else {
          	// å…ƒç´ ä¸æ˜¯null
            for (Node<E> x = last; x != null; x = x.prev) {
                if (o.equals(x.item)) {
                    unlink(x);
                    return true;
                }
            }
        }
        return false;
    }
```



# 6.å…¶ä»–æ–¹æ³•

æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ ,å…¶å®è°ƒç”¨çš„æ˜¯`indexOf()`æ–¹æ³•ï¼Œå¦‚æœè¿”å›çš„ç´¢å¼•ä¸ä¸º-1ï¼Œåˆ™åŒ…å«ï¼š

```java
    public boolean contains(Object o) {
        return indexOf(o) != -1;
    }
```

è¿”å›å¤§å°ï¼š

```java
    public int size() {
        return size;
    }
```

æ˜¯å¦ä¸ºæœ‰æ•ˆå…ƒç´ ä¸‹æ ‡ç´¢å¼•ï¼Œä»0åˆ°size-1

```java
    private boolean isElementIndex(int index) {
        return index >= 0 && index < size;
    }
```

æ˜¯å¦ä¸ºæœ‰æ•ˆä½ç½®ç´¢å¼•ï¼Œä»0åˆ°size

```java
    private boolean isPositionIndex(int index) {
        return index >= 0 && index <= size;
    }
```



è·å–æŒ‡å®šç´¢å¼•ä½ç½®çš„`ListIterator`:

```java
    public ListIterator<E> listIterator(int index) {
      	// æ£€æŸ¥åˆæ³•æ€§
        checkPositionIndex(index);
        return new ListItr(index);
    }
```

è·å–å€’åºçš„è¿­ä»£å™¨:

```java
    public Iterator<E> descendingIterator() {
        return new DescendingIterator();
    }
```

æ‹·è´å…‹éš†å‡½æ•°,ä¸€ä¸ªæ˜¯çˆ¶ç±»çš„å…‹éš†å‡½æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯é‡å†™çš„å…‹éš†å‡½æ•°ï¼Œè¿™é‡Œæ¯”è¾ƒç‰¹æ®Šï¼Œå› ä¸º`LinkedList`æ˜¯é“¾è¡¨ï¼Œæœ¬èº«åªä¿å­˜äº†ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªçš„å¼•ç”¨ï¼Œæ‰€ä»¥æ‹·è´çš„æ—¶å€™éœ€è¦å‘é‡Œé¢æ·»åŠ å…ƒç´ çš„æ–¹å¼è¿›è¡Œæ‹·è´ã€‚

```java
    public Object clone() {
        LinkedList<E> clone = superClone();

        // Put clone into "virgin" state
        clone.first = clone.last = null;
        clone.size = 0;
        clone.modCount = 0;

        // æ·»åŠ å…ƒç´ åˆ°æ‹·è´çš„é˜Ÿåˆ—ä¸­
        for (Node<E> x = first; x != null; x = x.next)
            clone.add(x.item);

        return clone;
    }
    private LinkedList<E> superClone() {
        try {
            return (LinkedList<E>) super.clone();
        } catch (CloneNotSupportedException e) {
            throw new InternalError(e);
        }
    }
```



è½¬æ¢æˆä¸ºæ•°ç»„ï¼Œé€šè¿‡å¾ªç¯å®ç°

```java
    public Object[] toArray() {
        Object[] result = new Object[size];
        int i = 0;
      	// å¾ªç¯å®ç°
        for (Node<E> x = first; x != null; x = x.next)
            result[i++] = x.item;
        return result;
    }
```

è½¬æ¢æˆä¸ºæŒ‡å®šç±»å‹çš„æ•°ç»„,å’Œå‰é¢ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œåˆå§‹åŒ–çš„æ—¶å€™ä½¿ç”¨ç±»å‹åå°„åˆ›å»º`(T[])java.lang.reflect.Array.newInstance(a.getClass().getComponentType(), size)`

```java
    public <T> T[] toArray(T[] a) {
        if (a.length < size)
            a = (T[])java.lang.reflect.Array.newInstance(
                                a.getClass().getComponentType(), size);
        int i = 0;
        Object[] result = a;
        for (Node<E> x = first; x != null; x = x.next)
            result[i++] = x.item;

        if (a.length > size)
            a[size] = null;

        return a;
    }
```

è·å–å¯åˆ†å‰²è¿­ä»£å™¨ï¼š

```java
    public Spliterator<E> spliterator() {
        return new LLSpliterator<E>(this, -1, 0);
    }
```



# 7.è¿­ä»£å™¨

é‡Œé¢å®šä¹‰äº†ä¸‰ç§è¿­ä»£å™¨ï¼Œéƒ½æ˜¯ä»¥å†…éƒ¨ç±»çš„æ–¹å¼å®ç°ï¼Œåˆ†åˆ«æ˜¯ï¼š

- ListItrï¼šåˆ—è¡¨çš„ç»å…¸è¿­ä»£å™¨
- DescendingIteratorï¼šå€’åºè¿­ä»£å™¨
- LLSpliteratorï¼šå¯åˆ†å‰²è¿­ä»£å™¨

## 7.1 ListItr

å…ˆæ¥è¯´è¯´`ListItr`ï¼Œè¿™ä¸ªè¿­ä»£å™¨ä¸»è¦æ˜¯æœ‰`next()`,`hashNext()`,`hasPrevious()`,`previous()`,`nextIndex()`,`previousIndex()`,`remove()`,`set()`,`add()`,`forEachRemaining()`æ–¹æ³•ï¼š

- `next()`ï¼šè·å–ä¸‹ä¸€ä¸ªå…ƒç´ 
- `hashNext()`:æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ 
- `hasPrevious()`ï¼šæ˜¯å¦æœ‰ä¸Šä¸€ä¸ªå…ƒç´ 
- `previous()`ï¼šä¸Šä¸€ä¸ªå…ƒç´ 
- `nextIndex()`ï¼šä¸‹ä¸€ä¸ªç´¢å¼•ä½ç½®
- `previousIndex()`ï¼šä¸Šä¸€ä¸ªç´¢å¼•ä½ç½®
- `remove()`ï¼šåˆ é™¤å½“å‰ç´¢å¼•ä½ç½®çš„å…ƒç´ 
- `set()`ï¼šæ›´æ–°å…ƒç´ 
- `add()`ï¼šæ–°å¢å…ƒç´ 
- `forEachRemaining()`ï¼šéå†å‰©ä¸‹çš„å…ƒç´ 



é‡Œé¢ä¸»è¦æœ‰é›†åˆé‡è¦çš„å±æ€§ï¼š

- `lastReturned`:ä¸Šä¸€æ¬¡è¿”å›çš„å…ƒç´ 
- `next`ï¼šä¸‹ä¸€ä¸ªè¿”å›çš„å…ƒç´ 
- `nextIndex`ï¼šä¸‹ä¸€ä¸ªç´¢å¼•
- `expectedModCount`ï¼šæœŸå¾…ä¿®æ”¹çš„æ¬¡æ•°

```JAVA
    private class ListItr implements ListIterator<E> {
      	// ä¸Šä¸€ä¸ªè¿”å›çš„å…ƒç´ 
        private Node<E> lastReturned;
      	// ä¸‹ä¸€ä¸ªå…ƒç´ 
        private Node<E> next;
      	// ä¸‹ä¸€ä¸ªç´¢å¼•
        private int nextIndex;
      	// æœŸå¾…çš„ä¿®æ”¹æ¬¡æ•°
        private int expectedModCount = modCount;
      	
      	// åˆå§‹åŒ–
        ListItr(int index) {
            // æ ¹æ®ç´¢å¼•ä½ç½®æ›´æ–°ä¸‹ä¸€ä¸ªè¿”å›çš„èŠ‚ç‚¹
            next = (index == size) ? null : node(index);
          	// æ›´æ–°ç´¢å¼•
            nextIndex = index;
        }
      	// æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼šç´¢å¼•æ˜¯å¦å°äºsize
        public boolean hasNext() {
            return nextIndex < size;
        }
      	// è·å–ä¸‹ä¸€ä¸ªå…ƒç´ 
        public E next() {
          	// æ£€æŸ¥ä¿®æ”¹åˆæ³•åŒ–
            checkForComodification();
          	// å¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ä¼šæŠ›å¼‚å¸¸ï¼Œæ‰€ä»¥ä½¿ç”¨å‰éœ€è¦å…ˆåˆ¤æ–­
            if (!hasNext())
                throw new NoSuchElementException();
          	// ä¸Šä¸€æ¬¡è¿”å›çš„å…ƒç´ æ›´æ–°
            lastReturned = next;
          	// æ›´æ–°ä¸‹ä¸€æ¬¡è¿”å›çš„å…ƒç´ 
            next = next.next;
          	// æ›´æ–°ç´¢å¼•
            nextIndex++;
          	// è¿”å›item
            return lastReturned.item;
        }
      
      	// æ˜¯å¦æœ‰ä¸Šä¸€ä¸ªï¼šä¸‹ä¸€ä¸ªè¿”å›çš„å…ƒç´ ç´¢å¼•æ˜¯ä¸æ˜¯å¤§äº0
        public boolean hasPrevious() {
            return nextIndex > 0;
        }
      	// è¿”å›ä¸Šä¸€ä¸ªå…ƒç´ 
        public E previous() {
          	// æ£€æŸ¥
            checkForComodification();
          	// åˆ¤æ–­æ˜¯å¦æœ‰ä¸Šä¸€ä¸ªå…ƒç´   
          	if (!hasPrevious())
                throw new NoSuchElementException();
          	// ä¸Šä¸€ä¸ªè¿”å›çš„å…ƒç´ ï¼Œéœ€è¦æ›´æ–°
            lastReturned = next = (next == null) ? last : next.prev;
            // æ›´æ–°ç´¢å¼•
          	nextIndex--;
            return lastReturned.item;
        }
      	// ä¸‹ä¸€ä¸ªç´¢å¼•
        public int nextIndex() {
            return nextIndex;
        }

      	// ä¸Šä¸€ä¸ªç´¢å¼•
        public int previousIndex() {
            return nextIndex - 1;
        }
	
      	// ç§»é™¤å½“å‰ä½ç½®çš„ç´¢å¼•
        public void remove() {
          	// æ£€æŸ¥ä¿®æ”¹åˆæ³•æ€§
            checkForComodification();
            if (lastReturned == null)
                throw new IllegalStateException();
						// è·å–ä¸‹ä¸€ä¸ªå…ƒç´ 
            Node<E> lastNext = lastReturned.next;
          	// ç§»é™¤ä¸Šä¸€ä¸ªè¿”å›çš„å…ƒç´ 
            unlink(lastReturned);
          	// å¦‚æœä¸‹ä¸€ä¸ªæ˜¯ä¸Šæ¬¡è¿”å›çš„å…ƒç´ ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªå…ƒç´ éœ€è¦æ›´æ–°ï¼Œå› ä¸ºè¯¥å…ƒç´ å·²ç»è¢«ç§»é™¤äº†
            if (next == lastReturned)
                next = lastNext;
            else
              	// æ›´æ–°ç´¢å¼•
                nextIndex--;
            lastReturned = null;
            expectedModCount++;
        }

      	// æ›´æ–°
        public void set(E e) {
            if (lastReturned == null)
                throw new IllegalStateException();
            checkForComodification();
            lastReturned.item = e;
        }

        public void add(E e) {
            checkForComodification();
            lastReturned = null;
          	// å¦‚æœä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯ç©ºï¼Œé‚£å°±æ˜¯åœ¨é˜Ÿå°¾æ·»åŠ å…ƒç´ 
            if (next == null)
                linkLast(e);
            else
              	// å¦åˆ™å°±æ˜¯åœ¨nextç´¢å¼•å¤„æ·»åŠ å…ƒç´ 
                linkBefore(e, next);
          	// æ›´æ–°ç´¢å¼•
            nextIndex++;
            expectedModCount++;
        }
				
      	// éå†å‰©ä¸‹çš„å…ƒç´ 
        public void forEachRemaining(Consumer<? super E> action) {
            Objects.requireNonNull(action);
          	// ä½¿ç”¨å¾ªç¯ï¼Œç´¢å¼•ä¸æ–­åç§»ï¼Œéå†
            while (modCount == expectedModCount && nextIndex < size) {
              	// å¯¹æ¯ä¸ªèŠ‚ç‚¹å…ƒç´ æ‰§è¡Œæ“ä½œ
                action.accept(next.item);
                lastReturned = next;
                next = next.next;
                nextIndex++;
            }
            checkForComodification();
        }

        final void checkForComodification() {
            if (modCount != expectedModCount)
                throw new ConcurrentModificationException();
        }
    }
```

ä¸Šé¢çš„è¿­ä»£å™¨æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯å¾€å‰é¢å’Œåé¢éå†çš„åŠŸèƒ½ï¼Œä»¥åŠå¢åˆ æ”¹çš„åŠŸèƒ½ã€‚

## 7.2 DescendingIterator

è¿™ä¸ªè¿­ä»£å™¨æœ‰ç‚¹æ„æ€ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªå€’åºçš„åŠŸèƒ½ï¼ŒåŠŸèƒ½å®ç°ä¹Ÿååˆ†ç®€å•ï¼š

- hasNext:æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå®é™…ä¸Šæ˜¯åˆ¤æ–­ä¸Šä¸€ä¸ªå…ƒç´ 
- nextï¼šè·å–ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå®é™…ä¸Šæ˜¯è·å–å‰é¢ä¸€ä¸ªå…ƒç´ 
- removeï¼šç§»é™¤å…ƒç´ 



å€’åºå°±æ˜¯åˆ«äººä»å‰å¾€åï¼Œå®ƒååä»åå¾€å‰éå†ï¼Œemmmmmmm

```java
    private class DescendingIterator implements Iterator<E> {
        private final ListItr itr = new ListItr(size());
        public boolean hasNext() {
            return itr.hasPrevious();
        }
        public E next() {
            return itr.previous();
        }
        public void remove() {
            itr.remove();
        }
    }
```



## 7.3 LLSpliterator

è¿™ä¸ªè¿­ä»£å™¨æœ‰ç‚¹ä¸œè¥¿ï¼Œæ„Ÿè§‰å’Œå…¶å®ƒçš„ä¸å¤ªä¸€æ ·ï¼Œ`LLSpliterator`æ˜¯åœ¨ä½¿ç”¨nodeçš„nextè¿›è¡Œè¿­ä»£ï¼Œä¸‹é¢åˆ†æä¸€ä¸‹ï¼šä¸»è¦æ˜¯ä¸ºäº†å°†å…ƒç´ åˆ†ä¸ºå¤šä»½ï¼Œç„¶åå†ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†ã€‚



å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šåˆ†å‰²çš„æ—¶å€™ï¼Œ`LinkedList`ä¸æ˜¯1/2åˆ†å‰²ï¼Œè€Œæ˜¯æ¯ä¸€æ¬¡åˆ†å‰²å‡ºæ¥çš„å¤§å°éƒ½æ˜¯é€’å¢çš„ï¼Œé€’å¢çš„å¤§å°æ˜¯`BATCH_UNIT`,ä½†æ˜¯è¿”å›çš„ä¸æ˜¯`LLSpliterator`ï¼Œè€Œæ˜¯`ArraySpliterator`ï¼Œæ¯æ¬¡éƒ½åˆ†å‰²å‡ºæ›´å¤šçš„å…ƒç´ ï¼Œè½¬æˆæ•°ç»„ç»“æ„ï¼Œè¿™ä¹Ÿè®¸æ˜¯å‡ºè‡ªäºæ€§èƒ½è€ƒè™‘ï¼Œæ¯”è¾ƒæŒ‡é’ˆéå†å¤ªæ…¢äº†ï¼Œæˆ‘çŒœçš„çš„...åˆ«æ‰“æˆ‘



```java
    static final class LLSpliterator<E> implements Spliterator<E> {
      	// åˆ†å‰²é•¿åº¦å¢åŠ å•ä½
        static final int BATCH_UNIT = 1 << 10;  // batch array size increment
      	// æœ€å¤§åˆ†å‰²é•¿åº¦
        static final int MAX_BATCH = 1 << 25;  // max batch array size;
        final LinkedList<E> list; // null OK unless traversed
      	// å½“å‰èŠ‚ç‚¹
        Node<E> current;      // current node; null until initialized
      	// å¤§å°ä¼°ç®—
        int est;  
      	// æœŸå¾…ä¿®æ”¹çš„æ¬¡æ•°
        int expectedModCount; // initialized when est set
      	// åˆ†å‰²é•¿åº¦
        int batch;            // batch size for splits

        LLSpliterator(LinkedList<E> list, int est, int expectedModCount) {
            this.list = list;
            this.est = est;
            this.expectedModCount = expectedModCount;
        }

        final int getEst() {
            int s; // force initialization
            final LinkedList<E> lst;
            if ((s = est) < 0) {
                if ((lst = list) == null)
                    s = est = 0;
                else {
                    expectedModCount = lst.modCount;
                    current = lst.first;
                    s = est = lst.size;
                }
            }
            return s;
        }
				// ä¼°ç®—å¤§å°
        public long estimateSize() { return (long) getEst(); }

      	// åˆ†å‰²
        public Spliterator<E> trySplit() {
            Node<E> p;
          	// è·å–å¤§å°
            int s = getEst();
          	// å½“å‰èŠ‚ç‚¹ä¸ä¸ºç©º
            if (s > 1 && (p = current) != null) {
              	// åˆ†å‰²ä½ç½®ç»“æŸï¼šåˆ†å‰²ä½ç½®+åˆ†å‰²å•ä½
                int n = batch + BATCH_UNIT;
              	// å¦‚æœå¤§äºå¤§å°ï¼Œå°±é™åˆ¶æœ€åçš„ä½ç½®
                if (n > s)
                    n = s;
              	// æœ€å¤§çš„åˆ†å‰²ä½ç½®
                if (n > MAX_BATCH)
                    n = MAX_BATCH;
              	// æ•°ç»„
                Object[] a = new Object[n];
                int j = 0;
              	// å°†å½“å‰ä½ç½®åˆ°nçš„ä½ç½®å¾ªç¯ï¼Œå­˜æ”¾åˆ°aæ•°ç»„ä¸­
                do { a[j++] = p.item; } while ((p = p.next) != null && j < n);
                current = p;
                batch = j;
                est = s - j;
              	// ArraySpliteratoræ¯æ¬¡åˆ†å‰²æˆä¸€åŠä¸€åŠï¼Œè€ŒIteratorSpliteratorç®—æœ¯é€’å¢
                return Spliterators.spliterator(a, 0, j, Spliterator.ORDERED);
            }
            return null;
        }

      	// å¯¹å‰©ä¸‹çš„å…ƒç´ è¿›è¡Œå¤„ç†
        public void forEachRemaining(Consumer<? super E> action) {
            Node<E> p; int n;
            if (action == null) throw new NullPointerException();
            if ((n = getEst()) > 0 && (p = current) != null) {
                current = null;
                est = 0;
                do {
                    E e = p.item;
                    p = p.next;
                    action.accept(e);
                } while (p != null && --n > 0);
            }
            if (list.modCount != expectedModCount)
                throw new ConcurrentModificationException();
        }

      	// å¯¹åé¢ä¸€ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†
        public boolean tryAdvance(Consumer<? super E> action) {
            Node<E> p;
            if (action == null) throw new NullPointerException();
            if (getEst() > 0 && (p = current) != null) {
                --est;
                E e = p.item;
                current = p.next;
                action.accept(e);
                if (list.modCount != expectedModCount)
                    throw new ConcurrentModificationException();
                return true;
            }
            return false;
        }

        public int characteristics() {
            return Spliterator.ORDERED | Spliterator.SIZED | Spliterator.SUBSIZED;
        }
    }
```

# 8.åºåˆ—åŒ–å’Œååºåˆ—åŒ–

åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œéœ€è¦é‡å†™ï¼Œå› ä¸ºæˆ‘ä»¬ä¿å­˜çš„åªæœ‰ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œæˆ‘ä»¬åºåˆ—åŒ–éœ€è¦ä¿å­˜å¤§å°å’Œå¼•ç”¨ï¼Œæ‰€ä»¥éœ€è¦é‡å†™ï¼Œè¦ä¸ååºåˆ—åŒ–å›æ¥å°±æ‰¾ä¸åˆ°`next`ï¼ŒèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»å°±ä¼šä¸¢å¤±ã€‚

åºåˆ—åŒ–çš„æ—¶å€™å¦‚ä¸‹ï¼Œå†™å…¥äº†`size`ï¼Œä»¥åŠéå†çš„æ—¶å€™å°†èŠ‚ç‚¹çš„`item`å€¼å†™å…¥ã€‚

```java
    private void writeObject(java.io.ObjectOutputStream s)
        throws java.io.IOException {
        // Write out any hidden serialization magic
        s.defaultWriteObject();

        // Write out size
        s.writeInt(size);

        // Write out all elements in the proper order.
        for (Node<E> x = first; x != null; x = x.next)
            s.writeObject(x.item);
    }
```



ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œè¯»å…¥å¤§å°`size`ä»¥åŠæ¯ä¸ªèŠ‚ç‚¹é‡Œé¢çš„å…ƒç´ `item`

```java
    private void readObject(java.io.ObjectInputStream s)
        throws java.io.IOException, ClassNotFoundException {
        // é»˜è®¤åºåˆ—åŒ–
        s.defaultReadObject();

        // å¤§å°
        int size = s.readInt();

        // æŒ‰ç…§é¡ºåºè¯»å…¥å…ƒç´ 
        for (int i = 0; i < size; i++)
            linkLast((E)s.readObject());
    }
```



# 9.æ€»ç»“ä¸€ä¸‹

- `LinkedList`åº•å±‚æ˜¯ç”¨é“¾è¡¨å®ç°çš„ï¼Œè€Œä¸”æ˜¯åŒå‘é“¾è¡¨ï¼Œå¹¶ä¸”å®ç°äº†`Queue`æ¥å£ï¼Œå¯ä»¥å½“æˆåŒå‘é˜Ÿåˆ—æˆ–è€…å †æ ˆæ¥ä½¿ç”¨ã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºæ˜¯é“¾è¡¨å®ç°ï¼Œæ‰€ä»¥åˆ é™¤å…ƒç´ æ¯”è¾ƒå¿«ï¼Œä½†æ˜¯æŸ¥æ‰¾çš„æ—¶å€™ç›¸å¯¹è¾ƒæ…¢ã€‚å½“ç„¶ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ‰©å®¹ï¼Œé™¤éå°±æ˜¯å†…å­˜ä¸å¤Ÿäº†ã€‚

- åŒå‘é“¾è¡¨ï¼Œå¯ä»¥ä»å¤´å¾€å°¾éå†ï¼Œä¹Ÿå¯ä»¥ä»å°¾éƒ¨å¾€å‰éå†ã€‚

-  `LinkedList`ç»§æ‰¿äº†`AbstractSequentialList`ï¼Œ`AbstractSequentialList`å®ç°äº†`get`,`set`,`add`,`remove`ç­‰æ–¹æ³•ã€‚

- åºåˆ—åŒ–/ååºåˆ—åŒ–çš„æ—¶å€™é‡å†™äº†æ–¹æ³•ï¼Œæ‰èƒ½è¾¾åˆ°åºåˆ—åŒ–é‡Œé¢æ¯ä¸€ä¸ªèŠ‚ç‚¹å…ƒç´ çš„æ•ˆæœã€‚
- çº¿ç¨‹ä¸å®‰å…¨

**ã€ä½œè€…ç®€ä»‹ã€‘**ï¼š  
ç§¦æ€€ï¼Œå…¬ä¼—å·ã€**ç§¦æ€€æ‚è´§åº—**ã€‘ä½œè€…ï¼ŒæŠ€æœ¯ä¹‹è·¯ä¸åœ¨ä¸€æ—¶ï¼Œå±±é«˜æ°´é•¿ï¼Œçºµä½¿ç¼“æ…¢ï¼Œé©°è€Œä¸æ¯ã€‚è¿™ä¸ªä¸–ç•Œå¸Œæœ›ä¸€åˆ‡éƒ½å¾ˆå¿«ï¼Œæ›´å¿«ï¼Œä½†æ˜¯æˆ‘å¸Œæœ›è‡ªå·±èƒ½èµ°å¥½æ¯ä¸€æ­¥ï¼Œå†™å¥½æ¯ä¸€ç¯‡æ–‡ç« ï¼ŒæœŸå¾…å’Œä½ ä»¬ä¸€èµ·äº¤æµã€‚

æ­¤æ–‡ç« ä»…ä»£è¡¨è‡ªå·±ï¼ˆæœ¬èœé¸Ÿï¼‰å­¦ä¹ ç§¯ç´¯è®°å½•ï¼Œæˆ–è€…å­¦ä¹ ç¬”è®°ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»ä½œè€…æ ¸å®åˆ é™¤ã€‚äººæ— å®Œäººï¼Œæ–‡ç« ä¹Ÿä¸€æ ·ï¼Œæ–‡ç¬”ç¨šå«©ï¼Œåœ¨ä¸‹ä¸æ‰ï¼Œå‹¿å–·ï¼Œå¦‚æœæœ‰é”™è¯¯ä¹‹å¤„ï¼Œè¿˜æœ›æŒ‡å‡ºï¼Œæ„Ÿæ¿€ä¸å°½~ 


![](https://markdownpicture.oss-cn-qingdao.aliyuncs.com/blog/20201012000828.png)



















